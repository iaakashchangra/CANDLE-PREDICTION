#!/usr/bin/env python3
"""
API Keys Setup Script for Candlestick Pattern Prediction System

This script helps you set up API keys for Alpha Vantage and Polygon.io data providers.
"""

import os
import sys
from pathlib import Path

def create_env_file():
    """Create .env file with API keys"""
    env_file = Path('.env')
    
    print("=" * 60)
    print("API Keys Setup for Candlestick Pattern Prediction System")
    print("=" * 60)
    print()
    
    # Check if .env already exists
    if env_file.exists():
        response = input(".env file already exists. Overwrite? (y/N): ")
        if response.lower() != 'y':
            print("Setup cancelled.")
            return
    
    print("Please provide your API keys:")
    print()
    
    # Alpha Vantage API Key
    print("1. Alpha Vantage API Key")
    print("   Get your free API key from: https://www.alphavantage.co/support/#api-key")
    alpha_key = input("   Enter your Alpha Vantage API key (or press Enter to skip): ").strip()
    
    print()
    
    # Polygon.io API Key
    print("2. Polygon.io API Key")
    print("   Get your free API key from: https://polygon.io/")
    polygon_key = input("   Enter your Polygon.io API key (or press Enter to skip): ").strip()
    
    # Create .env content
    env_content = f"""# API Configuration for Candlestick Pattern Prediction System
# Generated by setup_api_keys.py

# Alpha Vantage API Key
ALPHA_VANTAGE_API_KEY={alpha_key}

# Polygon.io API Key
POLYGON_API_KEY={polygon_key}

# Database Configuration (optional)
DB_HOST=localhost
DB_PORT=5432
DB_NAME=candlestick_db
DB_USER=postgres
DB_PASSWORD=password
"""
    
    # Write .env file
    try:
        with open('.env', 'w') as f:
            f.write(env_content)
        
        print()
        print("✅ .env file created successfully!")
        print()
        
        # Show status
        print("API Keys Status:")
        if alpha_key:
            print(f"  ✅ Alpha Vantage: Configured")
        else:
            print(f"  ⚠️  Alpha Vantage: Not configured (Yahoo Finance will be used as fallback)")
        
        if polygon_key:
            print(f"  ✅ Polygon.io: Configured")
        else:
            print(f"  ⚠️  Polygon.io: Not configured")
        
        print()
        print("Next steps:")
        print("1. Restart your application to load the new API keys")
        print("2. Test the data providers in the dashboard")
        
        if not alpha_key and not polygon_key:
            print("\n⚠️  Warning: No API keys configured. Only Yahoo Finance will be available.")
            print("   Consider getting free API keys for better data coverage and reliability.")
        
    except Exception as e:
        print(f"❌ Error creating .env file: {e}")
        sys.exit(1)

def main():
    """Main function"""
    try:
        create_env_file()
    except KeyboardInterrupt:
        print("\n\nSetup cancelled by user.")
        sys.exit(0)
    except Exception as e:
        print(f"\n❌ Unexpected error: {e}")
        sys.exit(1)

if __name__ == "__main__":
    main()